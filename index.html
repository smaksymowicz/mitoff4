<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fakty i Mity: Zdrowie</title>
<style>
body { font-family: Inter, sans-serif; background: #e6f0ff; margin:0; padding:0; color:#0f172a; }
.container { max-width: 900px; margin: 40px auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.1);}
h1 { text-align:center; margin-bottom:20px; }
input, button { width:100%; padding:10px; margin:5px 0 15px 0; border-radius:8px; border:1px solid #cbd5e1; font-size:16px; }
#report div { padding:12px; border-radius:12px; margin-bottom:10px; }
.source-link { font-size:13px; color:#1d4ed8; text-decoration:none; display:block; margin-bottom:3px; }
.disclaimer { margin-top:20px; font-size:13px; color:#f59e0b; }
.category { font-weight:bold; margin-top:10px; }
.question-item { cursor:pointer; padding:5px 10px; border-radius:6px; margin:2px 0; background:#f0f4f8; }
.question-item:hover { background:#d0e7ff; }
</style>
</head>
<body>
<div class="container">
  <h1>Fakty i Mity: Zdrowie</h1>

  <input type="text" id="questionInput" placeholder="Wpisz swoje pytanie">
  <button onclick="verifyFact()">Sprawdź</button>
  <div id="loading"></div>

  <div id="categories"></div>
  <div id="report"></div>

  <div class="disclaimer">
    ⚠️ Ta aplikacja bazuje na odpowiedziach sztucznej inteligencji i służy wyłącznie celom informacyjnym. W przypadku problemów zdrowotnych skonsultuj się z lekarzem.
  </div>
</div>

<script type="module">
import { predefinedAnswers } from './questions.js';

// Kategorie i pytania
const categories = [
  {
    id:"szczepienia",
    label:"Szczepienia",
    myths:[
      "Czy szczepionki powodują autyzm?",
      "Czy szczepionki przeciążają układ odpornościowy dziecka?",
      "Czy naturalne przechorowanie daje zawsze lepszą odporność niż szczepienie?",
      "Czy szczepionki zawierają toksyczne dawki rtęci lub aluminium?"
    ]
  },
  {
    id:"leki",
    label:"Leki i terapie",
    myths:[
      "Czy antybiotyki działają na infekcje wirusowe?",
      "Czy witamina C leczy przeziębienie?",
      "Czy leki przeciwbólowe zawsze niszczą wątrobę lub nerki?",
      "Czy suplementy diety mogą zastąpić leczenie farmakologiczne?",
      "Czy naturalne preparaty są zawsze bezpieczniejsze niż leki na receptę?"
    ]
  },
  {
    id:"zywienie",
    label:"Żywienie",
    myths:[
      "Czy jedzenie po godzinie 18:00 powoduje przyrost masy ciała?",
      "Czy gluten szkodzi każdemu?",
      "Czy brązowy cukier jest zdrowszy niż biały?",
      "Czy produkty 'light' zawsze sprzyjają odchudzaniu?",
      "Czy picie ośmiu szklanek wody dziennie jest konieczne dla każdego?",
      "Czy mleko jest niezbędne dorosłym dla zdrowych kości?"
    ]
  },
  {
    id:"detox",
    label:"Diety i 'detox'",
    myths:[
      "Czy diety sokowe oczyszczają organizm z toksyn?",
      "Czy organizm wymaga regularnego 'odkwaszania'?",
      "Czy głodówki przyspieszają metabolizm?",
      "Czy spalanie tłuszczu można ukierunkować na jedną część ciała ćwiczeniami?"
    ]
  },
  {
    id:"choroby",
    label:"Choroby, odporność i profilaktyka",
    myths:[
      "Czy zimne powietrze powoduje przeziębienie?",
      "Czy stres jest bezpośrednią przyczyną wrzodów żołądka?",
      "Czy cukier powoduje nadpobudliwość u dzieci?",
      "Czy kawa zawsze odwadnia organizm?",
      "Czy maseczki chronią przed wirusami?"
    ]
  },
  {
    id:"technologia",
    label:"Technologia i środowisko",
    myths:[
      "Czy kuchenki mikrofalowe niszczą wartości odżywcze bardziej niż tradycyjne gotowanie?",
      "Czy telefony komórkowe w standardowym użytkowaniu powodują nowotwory?",
      "Czy klimatyzacja bezpośrednio wywołuje choroby?",
      "Czy technologia 5G wpływa negatywnie na zdrowie?"
    ]
  }
];

// Renderowanie kategorii i pytań
const categoriesDiv = document.getElementById("categories");
categories.forEach(cat=>{
  const catDiv = document.createElement("div");
  catDiv.className="category";
  catDiv.innerText = cat.label;
  categoriesDiv.appendChild(catDiv);

  const ul = document.createElement("div");
  cat.myths.forEach(q=>{
    const qDiv = document.createElement("div");
    qDiv.className="question-item";
    qDiv.innerText = q;
    qDiv.onclick = ()=>{
      document.getElementById("questionInput").value = q;
      verifyFact();
    };
    ul.appendChild(qDiv);
  });
  categoriesDiv.appendChild(ul);
});

function colorFromProbability(p) {
  if(p<=33) return '#ef4444';       // czerwony
  if(p<=66) return '#f97316';       // pomarańczowy
  return '#22c55e';                  // zielony
}

function formatAIResponseJSON(data) {
  let html = '';

  // Ocena prawdziwości
  html += `<div style="background:${colorFromProbability(data.probability)}; color:white; font-weight:700; margin-bottom:8px;">
    Ocena prawdziwości: ${data.probability}% (${data.truth})
  </div>`;

  // Wyjaśnienie / konsensus
  html += `<div style="background:#d0e7ff; padding:10px; border-radius:8px; margin-bottom:8px;">
    <strong>Konsensus naukowy:</strong>
    <p>${data.explanation}</p>
  </div>`;

  // Źródła
  if(data.sources && data.sources.length>0){
    html += `<div style="background:#f5f5f5; border:1px solid #cbd5e1; padding:10px; border-radius:8px;">
      <strong>Źródła:</strong>`;
    data.sources.forEach(s=>{ html+=`<a class="source-link" href="${s}" target="_blank">${s}</a>`; });
    html += `</div>`;
  }

  return html;
}

async function verifyFact() {
  const question = document.getElementById("questionInput").value.trim();
  const report = document.getElementById("report");
  const loading = document.getElementById("loading");

  if(!question) return;

  // Sprawdzenie w bazie predefiniowanych odpowiedzi
  if(predefinedAnswers[question]){
    report.innerHTML = formatAIResponseJSON(predefinedAnswers[question]);
    return;
  }

  // Jeśli nie ma w bazie – idzie do AI
  loading.innerText = "Analiza...";
  report.innerHTML = "";

  try{
    const response = await fetch("/api/verify", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({question})
    });

    const data = await response.json();
    loading.innerText = "";
    // Jeżeli AI zwraca pełną treść, ustawiamy 50% i Nieznana jeśli nie ma jawnej oceny
    report.innerHTML = formatAIResponseJSON({ 
      probability: parseInt(data.probability || 50), 
      truth: data.truth || "Nieznana", 
      explanation: data.result || "Brak szczegółów",
      sources: data.sources || []
    });

  } catch(err){
    loading.innerText = "";
    report.innerText = "Błąd połączenia z serwerem.";
  }
}
</script>
</body>
</html>
